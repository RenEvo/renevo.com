<p>In my <a title="Community Server Sample Page" href="http://renevo.com/files/folders/articles_cs/entry252.aspx" target="_blank">last article</a>, I went into creating your own tabbed page that kept with the theme system of Community Server, today I will take it a step further and begin explaining on how to create a new control that will take advantage of the Community Server "skin" system.&nbsp; First and foremost, you "should" have a local running copy of CommunityServer if you plan on doing any development for it, if not, now is a good time to set one up really fast.</p> <p>Lets start out by copying our Default.aspx from our last exercise and naming it SkinnedControl.aspx in the Sample Directory.</p> <p>Open up the newly created aspx and delete the "samplepageContentPart" CS:ContentPart control.&nbsp; This will allow us to start from scratch with this article, feel free to leave the side menu, as it will be used later for linking the two pages the easy way.</p> <p>Next, double click on the right content part and add a link to the Default.aspx and the SkinnedControl.aspx for ease of navigating between the sample controls.&nbsp; This can be done with the following <strong>html</strong> code.</p> <p><em>&lt;BR&gt;<br>&lt;H4 class=CommonSidebarHeader&gt;Sample Page Links&lt;/H4&gt;<br>&lt;DIV class=CommonSidebarContent&gt;<br>&lt;ul&gt;<br>&lt;li&gt;&lt;a href="Default.aspx"&gt;Sample Page&lt;/a&gt;&lt;/li&gt;<br>&lt;li&gt;&lt;a href="SkinnedControl.aspx"&gt;Skinned Control&lt;/a&gt;&lt;/li&gt;<br>&lt;/ul&gt;<br>&lt;/DIV&gt;</em></p> <p>Now we have a nice side menu to be able to navigate between our sample pages, in future articles, you can simply add to this link list.</p> <p><strong>Creating our Web Class</strong></p> <p>This is where a decision needs to be made by you, you can code the control in any of the&nbsp;.Net languages, and for this article I have provided a VB and a C# project for the code.&nbsp; You can download either <a title="Download VB Express" href="http://renevo.com/files/folders/misc/entry156.aspx" target="_blank">VB Express</a> or <a title="C# Express" href="http://renevo.com/files/folders/misc/entry157.aspx" target="_blank">C# Express</a> to complete this article.</p> <p>Open up Visual Studio, and create a new Class Library Project, name it "RenEvo.CommunityServer.Articles" and click <strong>OK</strong>.</p> <p>First and foremost, rename "Class1" to "SampleControl". In VB this may or may NOT change the class name in code, if not, go ahead and change it now.</p> <p>Click on References, add Reference,&nbsp;and then Browse to your CommunityServer website's bin folder from the Browse tab, and select the following assemblies.</p> <ul> <li>CommunityServer.Components.dll</li> <li>CommunityServer.Controls.dll</li></ul> <p>Once again, Click on References, add Reference, and select System.Web from the .Net tab.</p> <p>And finally, we need to setup our build environment under C#, open up the properties window, select the Build tab, and browse to your CommunityServer's <strong>bin</strong> directory.&nbsp; This will be used to essentially deploy your assembly for debugging.&nbsp; In VB, double click on "My Project", select the Compile tab, and browse for the CommunityServer's <strong>bin</strong> directory.&nbsp; You can alternatively setup the Release Configuration to build to the same directory, but since this is a sample, I will not go over the recommended flags and settings for release builds.</p> <p>Lets open up our SampleControl class code.</p> <p>To save some typing, we are going to import some namespaces into our class.</p> <p><strong><em>C#</em></strong></p> <p><em>using System;<br>using System.Text;<br>using System.Web.UI;<br>using System.Web.UI.WebControls;<br>using System.Collections.Generic;<br>using CommunityServer.Controls;<br>using CommunityServer.Components;</em></p> <p><strong><em>VB</em></strong></p> <p><em>Imports System.Text<br>Imports System.Web.UI<br>Imports System.Web.UI.WebControls<br>Imports CommunityServer.Controls<br>Imports CommunityServer.Components</em></p> <p>Next, we will inherit the CommunityServer's TemplatedWebControl</p> <p><strong><em>C#</em></strong></p> <p><em>public class SampleControl:TemplatedWebControl</em></p> <p><strong><em>VB</em></strong></p> <p><em>Public Class SampleControl : Inherits TemplatedWebControl</em></p> <p>Create a Region that will contain our Private Declarations, we will store a Title that will be settable in the aspx when creating the control on a page.</p> <p><strong><em>C#</em></strong></p> <p><em>#region Private Declares<br>String m_Title = ""<br>#endregion</em></p> <p><strong><em>VB</em></strong></p> <p><em>#Region " Private Declares " </em></p> <p><em>Private m_Title As String = "" </em> <p><em>#End Region</em> <p>Before we go and build, we still have a bit more to do, so stay away from that build button.&nbsp; At this point we have created a new project, added some references to CommunityServer, and added our "codebehind" for our skinned control.&nbsp; What you have noticed if you have ever developed web pages is that we have not added a .ascx to our project, the reason behind this is that we are using the CommunityServer framework to build and display our control based on some settings that we will apply next for "skinning" a control.&nbsp; What basically happens is that when a CommunityServer page creates your control, it then calls the "AttachChildControls" function to allow you to bind any internal controls that you have for your control manually via "FindControl".&nbsp; This allows developers to only put items that they need in any new skins that they create.&nbsp; It is VERY important to check for nulls on any controls you "think" are on the page, as they might not actually have been included in the skin. <p><strong>Skinning Support</strong> <p>Now that we have cracked our Class a bit, lets add some "skin" support to the code behind. <p>Create a new region (hey, regions are fantastic ways to organize your code) with a title of "Skin Support", create a new protected variable called SkinnedControl of type WebControls.Repeater.&nbsp; Do not set this to new, this will be our internal reference to our "imaginary" control in the skin. <p>Next we will want to override two function in the base class (TemplatedWebControl) <em>OnInit</em> and <em>AttachChildControls</em> Both of these will be used for applying our skin at run time, and informing the framework exactly what files to use. <em>OnInit</em> we will simply specify our ExternalSkinFileName and then call the base class's OnInit.&nbsp; In <em>AttachChildControls</em> we will attempt to set our SkinnedControl.&nbsp; Below is the code snippets to accomplish this. <p><strong><em>C#</em></strong> <p><em>#region Skin Support<br>Repeater SkinnedControl; </em> <p><em>protected override void OnInit(EventArgs e)<br>{<br>// set our skin name, this is the "./Themes/&lt;currentskinname&gt;/" folder<br>base.ExternalSkinFileName = "Skin-SampleControl.ascx"<br>base.OnInit(e);<br>} </em> <p><em>protected override void AttachChildControls()<br>{<br>// attach our reference to the control in the skin (if it exists)<br>SkinnedControl = (Repeater)FindControl("SkinnedControl");<br>} </em> <p><em>#endregion</em> <p><strong><em>VB</em></strong> <p><em>#Region " Skin Support " </em> <p><em>Protected SkinnedControl As WebControls.Repeater </em> <p><em>Protected Overrides Sub OnInit(ByVal e As System.EventArgs)<br>'set our skin name, this is the "./Themes/&lt;currentskinname&gt;/" folder<br>MyBase.ExternalSkinFileName = "Skin-SampleControl.ascx"<br>MyBase.OnInit(e)<br>End Sub </em> <p><em>Protected Overrides Sub AttachChildControls()<br>'attach our reference to the control in the skin (if it exists)<br>SkinnedControl = FindControl("SkinnedControl")<br>End Sub </em> <p><em>#End Region</em> <p><strong>Databinding</strong> <p>Databinding is a part of everything that makes a website function dynamically, without it, it would be a plethera of hard-coded table generation and response.write statements (remember asp 3.0 and php?).&nbsp; Since we aren't quite covering data layers etc... yet in this article, we will simply create a fopa table in code and use it as a binding source.&nbsp; To do this, we are going to override the base class's <em>Databind</em> method, call our base class databind function first, see if our SkinnedControl is set to an instance (to prevent errors, remember), create a sample datatable, then bind it to our control.&nbsp; And once again, we will include this section inside of a region called "Databinding". <p><strong><em>C#</em></strong> <p><em>#region Databinding </em> <p><em>public override void DataBind()<br>{<br>base.DataBind(); </em> <p><em>if (SkinnedControl != null)<br>{<br>// Create a sample table<br>System.Data.DataTable dt = new System.Data.DataTable("SampleTable");<br>// Add Columns<br>dt.Columns.Add("Column1");<br>dt.Columns.Add("Column2");<br>dt.Columns.Add("Column3");<br>// Add Rows<br>dt.Rows.Add("1", "2", "3");<br>dt.Rows.Add("4", "5", "6");<br>dt.Rows.Add("7", "8", "9"); </em> <p><em>// Bind it to our skinned control<br>SkinnedControl.DataSource = dt;<br>SkinnedControl.DataBind();<br>}<br>} </em> <p><em>#endregion</em> <p><strong><em>VB</em></strong> <p><em>#Region " Databinding " </em> <p><em>Public Overrides Sub DataBind()<br>MyBase.DataBind() </em> <p><em>If Not SkinnedControl Is Nothing Then<br>'Create a sample table<br>Dim dt As New DataTable("SampleTable")<br>'Add Columns<br>dt.Columns.Add("Column1")<br>dt.Columns.Add("Column2")<br>dt.Columns.Add("Column3")<br>'Add Rows<br>dt.Rows.Add(New String() {"1", "2", "3"})<br>dt.Rows.Add(New String() {"4", "5", "6"})<br>dt.Rows.Add(New String() {"7", "8", "9"}) </em> <p><em>'Bind it to our skinned control<br>SkinnedControl.DataSource = dt<br>SkinnedControl.DataBind()<br>End If<br>End Sub </em> <p><em>#End Region</em> <p>Next, we need to call the databind function, for our purposes, we are going to override the RenderContents method, check for postback, if false, then we will databind, then finally tell our base class to RenderContents.&nbsp; Once again, we put the Render code inside of a Render Region <p><strong><em>C#</em></strong> <p><em>#region Render<br>protected override void RenderContents(HtmlTextWriter writer)<br>{<br>// bind our data<br>if (Page.IsPostBack == false)<br>{<br>DataBind();<br>} </em> <p><em>// this will apply our skinned asp:repeater here<br>base.RenderContents(writer);<br>}<br>#endregion</em></p> <p><strong><em>VB</em></strong></p> <p><em>#Region " Render " </em></p> <p><em>Protected Overrides Sub RenderContents(ByVal writer As System.Web.UI.HtmlTextWriter)<br>'bind our data<br>If Page.IsPostBack = False Then<br>DataBind()<br>End If </em></p> <p><em>'this will apply our skinned asp:repeater here<br>MyBase.RenderContents(writer) </em></p> <p><em>End Sub </em> <p><em>#End Region</em> <p>&nbsp; <p><strong>Build and test</strong> <p>At this point, we can take a break for all of you impatient people, and see if our control works or not, then we will get into customizing it a bit more.&nbsp; First things first, hit the build button.&nbsp; If you followed the code snippets correctly, you should have had a clean build, if not, go back and check what might have went wrong. C# may throw a warning that m_Title is set but never used, this will be rectified near the end of this article. <p>Now, we need to create a new ascx for our skin, above we named it "Skin-SampleControl.ascx", so open up your CommunityServer/Themes/default/Skins folder and create a new text document aptly named "Skin-SampleControl.ascx".&nbsp; If you would like, you can now open this file with your favorite editor, I prefer visual studio myself. <p>Since we are doing a simple control without anything special on it, and obviously no code behind, we need to do no special directives at the top of the file.&nbsp; Lets just add a simple asp:repeater control, name it "SkinnedControl" as per our code looks for this control, and then give it a very simplistic headertemplate that creates a table and column header row, an itemtemplate that just iterates our 3 sample columns, and a footertemplate to close the table.&nbsp; Below is the ascx code, and how it should look for this sample. <p><strong><em>ASP.Net</em></strong> <p><em>&lt;!-- <br>This is a sample control, this specific control only has a repeater on it.<br>//--&gt;<br>&lt;asp:repeater id="SkinnedControl" runat="server"&gt;<br>&lt;HeaderTemplate&gt;<br>&lt;table border="0" class="CommonSidebarContent"&gt;<br>&lt;tr&gt;<br>&lt;td width="140" align="left" class="CommonBreadCrumbArea"&gt;Column1&lt;/td&gt;&lt;td width="30" align="left" class="CommonBreadCrumbArea"&gt;Column2&lt;/td&gt;&lt;td width="30" align="left" class="CommonBreadCrumbArea"&gt;Column3&lt;/td&gt;<br>&lt;/tr&gt; <br>&lt;/HeaderTemplate&gt;<br>&lt;ItemTemplate&gt;<br>&lt;tr&gt;<br>&lt;td&gt;<br>&lt;b&gt;&lt;%# DataBinder.Eval(Container.DataItem, "Column1")%&gt;<br>&lt;/td&gt;<br>&lt;td&gt;<br>&lt;%# DataBinder.Eval(Container.DataItem, "Column2")%&gt;<br>&lt;/td&gt;<br>&lt;td&gt;<br>&lt;%# DataBinder.Eval(Container.DataItem, "Column3")%&gt;<br>&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;/ItemTemplate&gt;<br>&lt;FooterTemplate&gt;<br>&lt;/table&gt;<br>&lt;/FooterTemplate&gt;<br>&lt;/asp:repeater&gt;</em></p> <p>Save the control, and now lets add the control to our SkinnedControl.aspx we created earlier in the article. (CommunityServer/Sample/SkinnedControl.aspx).</p> <p><strong>Add the control to the page</strong></p> <p>First we want to register a tag prefix for the project, lets add it just above the Import Namespace line.</p> <p><em>&lt;%@ Register TagPrefix="SC" Namespace="RenEvo.CommunityServer.Articles" Assembly="RenEvo.CommunityServer.Articles" %&gt;</em></p> <p>Next, just below our first AdPart, lets add the control to the page.</p> <p><em>&lt;SC:SampleControl runat="server" id="SampleControl1" /&gt;</em></p> <p>Pretty easy huh?&nbsp; Now, the moment you have been waiting for, lets go ahead and visit the SkinnedControl.aspx!</p> <p>If you have followed this article to the tee, you should have a little table with 3 columns and 4 rows the first one being the column headers.&nbsp; If not, go back over the article and figure out where you went wrong.&nbsp; No seriously, you didn't pay attention, start over.</p> <p>Ok, now I am going to tell you what that m_Title was for, as well as some tricks to make this a bit more snazzy.</p> <p><strong>Customizing the Control</strong></p> <p>Lets create a property that will wrap our m_Title internal variable.&nbsp;I love me some Regions...</p> <p><strong><em>C#</em></strong></p> <p><em>#region Properties<br>public string Title<br>{<br>get { return m_Title; }<br>set { m_Title = value; }<br>}<br>#endregion</em></p> <p><strong><em>VB</em></strong></p> <p><em>#Region " Properties " </em></p> <p><em>Public Property Title() As String<br>Get<br>Return m_Title<br>End Get<br>Set(ByVal value As String)<br>m_Title = value<br>End Set<br>End Property </em> <p><em>#End Region</em> <p>Now, lets go ahead and do a generic way to&nbsp;output the&nbsp;"Title"&nbsp;of our control. In the RenderContents function, add the following code below the databind, but above the call to the base class to RenderContents. <p><strong><em>C#</em></strong> <p><em>// pre writer stuff<br>// optional title<br>if (m_Title.Length &gt; 0)<br>{<br>writer.WriteBeginTag("div");<br>writer.WriteAttribute("class", "CommonMessageTitle");<br>writer.Write(HtmlTextWriter.TagRightChar);<br>writer.Write(m_Title);<br>writer.WriteEndTag("div");<br>}</em></p> <p><strong><em>VB</em></strong></p> <p><em>'pre writer stuff<br>'optional title<br>If Me.Title.Length &gt; 0 Then<br>writer.WriteBeginTag("div")<br>writer.WriteAttribute("class", "CommonMessageTitle")<br>writer.Write(HtmlTextWriter.TagRightChar)<br>writer.Write(m_Title)<br>writer.WriteEndTag("div")<br>End If</em></p> <p>Now if we build and refresh our page, you will notice nothing changed, that is because we did not set our Title in the control definition.&nbsp; Open up SkinnedControl.aspx and add the title="Sample Title" attribute to the SampleControl. When you save and refresh the page, you will notice now that you have a nifty title above the table!&nbsp; Below is the code, incase you goofed up those easy instructions.</p> <p><em>&lt;SC:SampleControl runat="server" id="SampleControl1" title="Sample Control" /&gt;</em></p> <p>That is pretty much it, but to clean it up, and show you a bit more of what is possible, I have added a bit more code to the RenderContents function that fully wraps the table with some custom styling.&nbsp; Modified RenderContents below</p> <p><strong><em>C#</em></strong></p> <p><em>#region Render<br>protected override void RenderContents(HtmlTextWriter writer)<br>{<br>// bind our data<br>if (Page.IsPostBack == false)<br>{<br>DataBind();<br>} </em></p> <p><em>// pre writer stuff<br>// optional title<br>if (m_Title.Length &gt; 0)<br>{<br>writer.WriteBeginTag("div");<br>writer.WriteAttribute("class", "CommonMessageTitle");<br>writer.Write(HtmlTextWriter.TagRightChar);<br>writer.Write(m_Title);<br>writer.WriteEndTag("div");<br>}<br>// our wrapper for the content<br>writer.WriteBeginTag("div");<br>writer.WriteAttribute("class", "CommonMessageContent");<br>writer.WriteAttribute("id", this.ID);<br>writer.Write(HtmlTextWriter.TagRightChar); </em> <p><em>// this will apply our skinned asp:repeater here<br>base.RenderContents(writer); </em> <p><em>// close our content wrapper<br>writer.WriteEndTag("div");<br>}<br>#endregion</em></p> <p><strong><em>VB</em></strong></p> <p><em>#Region " Render " </em></p> <p><em>Protected Overrides Sub RenderContents(ByVal writer As System.Web.UI.HtmlTextWriter)<br>'bind our data<br>If Page.IsPostBack = False Then<br>DataBind()<br>End If </em> <p><em>'pre writer stuff<br>'optional title<br>If Me.Title.Length &gt; 0 Then<br>writer.WriteBeginTag("div")<br>writer.WriteAttribute("class", "CommonMessageTitle")<br>writer.Write(HtmlTextWriter.TagRightChar)<br>writer.Write(m_Title)<br>writer.WriteEndTag("div")<br>End If </em> <p><em>'our wrapper for the content<br>writer.WriteBeginTag("div")<br>writer.WriteAttribute("class", "CommonMessageContent")<br>writer.WriteAttribute("id", Me.ID)<br>writer.Write(HtmlTextWriter.TagRightChar) </em> <p><em>'this will apply our skinned asp:repeater here<br>MyBase.RenderContents(writer) </em> <p><em>'close our content wrapper<br>writer.WriteEndTag("div")<br>End Sub </em> <p><em>#End Region</em> <p><strong>End of article wrap up</strong></p> <p>Throughout this article you have gotten a decent grasp on how the skin system works with CommunityServer, it is not nearly as overwhelming as some might imagine, and is actually kind of fun once you get the hang of it, something about binding a code blindly to an ascx really got me fired up that in my own product when the need arose to have a secondary view format for a specific web page, I took a similar approach with creating multiple ascx files that had the same code behind, and it worked out wonderfully.</p> <p>Some key things that I would like to mention about this article is, the original article had rave reviews and fantastic feedback, which prompted me to want to write more, as it seems that I have something to offer to the CommunityServer community.&nbsp; I have provided with this article all of the files neccessary to get the sample running on your site before even cracking the code which is available in C# and Visual Basic from the download link below.</p> <p>Again, thanks to everyone for thier support, it is really encouraging to find that you spend time writing an article and it gets such great responses.</p> <p><a title="Get the code!" href="http://renevo.com/files/folders/articles_cs/entry516.aspx" target="_blank">Download Article Code</a></p> <p><a title="View the online demo" href="http://renevo.com/Sample/SkinnedControl.aspx" target="_blank">See the online demo!</a></p><img src="http://renevo.com/aggbug.aspx?PostID=517" width="1" height="1">